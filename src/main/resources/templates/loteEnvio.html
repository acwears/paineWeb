<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
      
<head th:include="layout :: headerFragment"></head>

<body>
	<div th:include="layout :: menuFragment"></div>


	<div id="container">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Recibos cargados</h3>
			</div>
			<div class="panel-body">
				<!-- Table -->
				<table class="table table-hover" id="tblRecibos">
					<thead>
						<tr>
							<th style="display: none;"></th>
							<th><font color="#000000">Recibo #</font></th>
							<th><font color="#000000">Fecha</font></th>
							<th><font color="#000000">Cliente #</font></th>
							<th><font color="#000000">Nombre</font></th>
							<th><font color="#000000">Importe total</font></th>
							<th><font color="#000000">Lote</font></th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="varRecibosSinEnviar : ${recibos}">
							<td class="miId" th:text="${varRecibosSinEnviar.id}" style="display: none;"></td>
							<td th:text="${varRecibosSinEnviar.numero}"></td>
							<td th:text="${varRecibosSinEnviar.fecha}"></td>
							<td th:text="${varRecibosSinEnviar.getCliente().numeroCliente}"></td>
							<td th:text="${varRecibosSinEnviar.getCliente().nombre}"></td>
							<td th:text="${varRecibosSinEnviar.importeTotal}"></td>
							<td><input type="checkbox" name="myTextEditBox" value="checked" style="margin-left:auto; margin-right:auto;"></td>
						</tr>
					</tbody>
				</table>
			</div>
			<input class="btn btn-secondary btn-sm" type="button" value="Seleccionar todos" id="idSelectAll">
		</div>
		<input class="btn btn-primary btn-lg" type="button" value="Enviar Lote" id="idEnviarLote">
		<br>
		<br>
	<!-- 	<input th:value="${nroLote}" id="idNroLote" readonly="readonly" width="50px">  -->
	</div>

	<div th:include="layout :: footerFragment"></div>
	
	<form action="#" th:action="@{/salvarLote}" th:object="${loteDto}" method="post" id="reciboFormId">
	</form>
	
</body>

<style> 
#mnuLoteEnvio{color:white;} 
</style> 

<script type="text/javascript">
$(document).ready(function(){
	
	$("#successMessage").fadeOut(10000);
	$("#errorMessage").fadeOut(10000);
	
	$("#idSelectAll").click(function(){
		
		$('#tblRecibos').find('tr').each(function () {
	        var row = $(this);
	        if (row.find('input[type="checkbox"]').is(':checked')) {
	        }
	        else{
	        	row.find('input[type="checkbox"]').prop( "checked", true );
	        }
	    });
		
	});
	
	
	$("#idEnviarLote").click(function(){
		var noSeleccionoRecibo = true;
		
		$('#tblRecibos').find('tr').each(function () {
	        var row = $(this);
	        if (row.find('input[type="checkbox"]').is(':checked')) {
	        	noSeleccionoRecibo = false;
	        	var idHiddenDate = new Date();
				var idHiddenDate2 = idHiddenDate.getTime().toString();
				
	        	var reciboId = $(this).find('.miId').text();
	        	//alert('this checkbox is checked');
	            //alert($(this).find('td').text());//esta linea que me traiga el valor de la primera celda
	            //alert($(this).find('.miId').text());
	            
	            crearHiddenB('reciboId', reciboId, idHiddenDate2);
	        }
	    });
		
		if(noSeleccionoRecibo){
			alert("Debe seleccionar al menos un recibo!");
			return;
		}
		
		$('#reciboFormId').submit();
	});
});

crearHiddenB = function(nameVar, valueVar, id){
	//elimino los '.' y los espacios en blanco para el ID del Hidden
	var AuxId = id;
	AuxId = AuxId.split(' ').join('');
	AuxId = AuxId.split('.').join('');
	AuxId = AuxId.split(',').join('');
	AuxId = AuxId.split('/').join('');
	
	var tempHidden = $('<input>').attr({
		'type': 'hidden',
		'name': nameVar, 
		'value': valueVar,
		'class':AuxId
	});
	
	$('#reciboFormId').append(tempHidden);
};
</script>

</html>